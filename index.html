<!DOCTYPE html>
<html>
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Blackjack Counter</title>

  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    h2 { text-align: center; }

    button, select {
      margin: 4px;
      padding: 10px 14px;
      font-size: 16px;
    }

    #reset { background: #e53935; color: white; border: none; }
    #undo { background: #1976d2; color: white; border: none; }

    p { font-size: 18px; }

    #history {
      margin-top: 15px;
      padding: 10px;
      border: 2px solid #ccc;
      min-height: 40px;
    }

    .card {
      display: inline-block;
      padding: 4px 8px;
      margin: 2px;
      border-radius: 5px;
      background: #f1f1f1;
      border: 1px solid #aaa;
    }
  </style>
</head>

<body>

<h2>Blackjack Counter</h2>

<label>
  Decks:
  <select id="deckSelect">
    <option value="4">4</option>
    <option value="5">5</option>
    <option value="6">6</option>
    <option value="7">7</option>
    <option value="8">8</option>
  </select>
</label>

<p>Running Count: <strong><span id="rc">0</span></strong></p>
<p>True Count: <strong><span id="tc">0</span></strong></p>
<p id="advice">Bet advice:</p>
<p id="next">Most likely next card: ?</p>

<div>
  <button onclick="card('2')">2</button>
  <button onclick="card('3')">3</button>
  <button onclick="card('4')">4</button>
  <button onclick="card('5')">5</button>
  <button onclick="card('6')">6</button>
  <button onclick="card('7')">7</button>
  <button onclick="card('8')">8</button>
  <button onclick="card('9')">9</button>
  <button onclick="card('10')">10</button>
  <button onclick="card('J')">J</button>
  <button onclick="card('Q')">Q</button>
  <button onclick="card('K')">K</button>
  <button onclick="card('A')">A</button>
</div>

<br>
<button id="undo" onclick="undo()">â¬… Back</button>
<button id="reset" onclick="resetAll()">Reset</button>

<h3>Card History</h3>
<div id="history"></div>

<script>
  let DECKS = 4;
  let runningCount = 0;
  let history = [];
  let deck = {};

  const values = {
    "2":1,"3":1,"4":1,"5":1,"6":1,
    "7":0,"8":0,"9":0,
    "10":-1,"J":-1,"Q":-1,"K":-1,"A":-1
  };

  function buildDeck() {
    deck = {
      "2":4*DECKS,"3":4*DECKS,"4":4*DECKS,"5":4*DECKS,"6":4*DECKS,
      "7":4*DECKS,"8":4*DECKS,"9":4*DECKS,
      "10":4*DECKS,"J":4*DECKS,"Q":4*DECKS,"K":4*DECKS,"A":4*DECKS
    };
  }

  function remainingDecks() {
    let cards = 0;
    for (let c in deck) cards += deck[c];
    return cards / 52;
  }

  function updateHistory() {
    const h = document.getElementById("history");
    h.innerHTML = "";
    history.forEach(c => {
      const span = document.createElement("span");
      span.className = "card";
      span.textContent = c;
      h.appendChild(span);
    });
  }

  function update() {
    document.getElementById("rc").textContent = runningCount;
    const tc = remainingDecks() > 0
      ? runningCount / remainingDecks()
      : runningCount;
    document.getElementById("tc").textContent = tc.toFixed(2);

    if (tc >= 2) document.getElementById("advice").textContent = "Bet advice: Raise bet!";
    else if (tc >= 1) document.getElementById("advice").textContent = "Bet advice: Normal bet";
    else document.getElementById("advice").textContent = "Bet advice: Lower bet!";

    let max = 0, likely = "?";
    for (let c in deck) {
      if (deck[c] > max) {
        max = deck[c];
        likely = c;
      }
    }
    document.getElementById("next").textContent = "Most likely next card: " + likely;

    updateHistory();
  }

  function card(c) {
    if (deck[c] <= 0) {
      alert(c + " exhausted");
      return;
    }
    deck[c]--;
    runningCount += values[c];
    history.push(c);
    update();
  }

  function undo() {
    if (!history.length) return;
    const last = history.pop();
    deck[last]++;
    runningCount -= values[last];
    update();
  }

  function resetAll() {
    runningCount = 0;
    history = [];
    buildDeck();
    document.getElementById("advice").textContent = "Bet advice:";
    document.getElementById("next").textContent = "Most likely next card: ?";
    update();
  }

  document.getElementById("deckSelect").addEventListener("change", e => {
    DECKS = parseInt(e.target.value);
    resetAll();
  });

  document.addEventListener("keydown", e => {
    const k = e.key.toUpperCase();
    if ("23456789".includes(k)) card(k);
    else if (k === "0") card("10");
    else if ("JQKA".includes(k)) card(k);
    else if (k === "BACKSPACE") undo();
    else if (k === "R" || k === " ") resetAll();
  });

  buildDeck();
  update();
</script>

</body>
</html>
